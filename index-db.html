<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sixty4BitFreelancing's Dash - Advanced Client & Invoice Manager</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --toast-bg: #fff;
            --toast-text: #333;
            --toast-success-border: #28a745;
            --toast-error-border: #dc3545;
            --primary-color: #6366f1;
            --primary-hover: #4f46e5;
            --secondary-color: #14b8a6;
            --secondary-hover: #0d9488;
        }
        
        html.dark {
            --toast-bg: #121212;
            --toast-text: #FFFFFF;
            --toast-success-border: #34d399;
            --toast-error-border: #f87171;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            background-color: var(--toast-bg);
            color: var(--toast-text);
            border-left: 5px solid;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            transform: translateX(calc(100% + 20px));
            transition: transform 0.5s ease-in-out;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-color: var(--toast-success-border);
        }
        
        .toast.error {
            border-color: var(--toast-error-border);
        }
        
        #invoice-content td, #invoice-content th {
            word-break: break-word;
        }

        @media print {
            body > *:not(#invoice-modal) {
                display: none;
            }
            #invoice-modal {
                display: block !important;
                position: static !important;
                inset: auto !important;
                background: transparent !important;
                padding: 0 !important;
                overflow: visible !important;
                z-index: 9999;
            }
            #invoice-modal-content {
                box-shadow: none !important;
                border: 1px solid #ddd;
                transform: none !important;
                max-width: 100% !important;
                margin: 0 !important;
                height: auto !important;
                max-height: none !important;
            }
            #invoice-actions {
                display: none !important;
            }
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        .pdf-render-mode {
            background-color: #000 !important;
            color: #fff !important;
        }
        .pdf-render-mode * {
            color: #fff !important;
            border-color: #333 !important;
            background-color: transparent !important;
        }
        .pdf-render-mode a { 
            color: #818cf8 !important; 
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Card hover effects */
        .hover-card {
            transition: all 0.3s ease;
        }
        
        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Toggle switch styling */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* Dashboard stats cards */
        .stat-card {
            border-left: 4px solid;
        }
        
        /* Badge styling */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        'primary-hover': '#4f46e5',
                        secondary: '#14b8a6',
                        'secondary-hover': '#0d9488',
                        'jet-black': '#000000',
                        'dark-card': '#121212',
                        'neon-white': '#FFFFFF',
                        'dark-border': '#27272a',
                        'light-gray': '#d1d5db',
                        'mid-gray': '#9ca3af',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 dark:bg-jet-black text-slate-800 dark:text-neon-white transition-colors duration-300">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-slate-50 dark:bg-jet-black">
        <div class="bg-white dark:bg-dark-card rounded-xl shadow-xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white flex items-center justify-center mb-2">
                    <i class="fas fa-laptop-code mr-3 text-primary"></i>
                    Sixty4BitFreelancing
                </h1>
                <p class="text-slate-500 dark:text-mid-gray">Client & Invoice Manager</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="login-password" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-2">Enter Password</label>
                    <input type="password" id="login-password" required 
                           class="w-full px-4 py-3 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary text-center text-lg"
                           placeholder="Enter your password">
                </div>
                
                <button type="submit" class="w-full bg-primary hover:bg-primary-hover text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all">
                    <i class="fas fa-unlock mr-2"></i>Access Dashboard
                </button>
            </form>
            
            <div id="login-error" class="mt-4 text-center text-red-600 dark:text-red-400 hidden">
                <i class="fas fa-exclamation-triangle mr-2"></i>Incorrect password
            </div>
        </div>
    </div>

    <div id="app" class="min-h-screen flex hidden">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white dark:bg-dark-card shadow-lg z-30 flex-shrink-0 hidden md:block">
            <div class="p-6 border-b border-slate-200 dark:border-dark-border">
                <h1 class="text-xl font-bold text-slate-900 dark:text-white flex items-center">
                    <i class="fas fa-laptop-code mr-2 text-primary"></i>
                    Sixty4BitFreelancing
                </h1>
                <p class="text-sm text-slate-500 dark:text-mid-gray mt-1">Client & Invoice Manager</p>
            </div>
            
            <nav class="p-4">
                <ul id="main-nav" class="space-y-2">
                    <li>
                        <a href="#dashboard" class="flex items-center p-3 rounded-lg text-primary bg-primary/10 font-medium">
                            <i class="fas fa-chart-pie mr-3"></i>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#clients" class="flex items-center p-3 rounded-lg text-slate-600 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                            <i class="fas fa-users mr-3"></i>
                            Clients
                        </a>
                    </li>
                    <li>
                        <a href="#work-logs" class="flex items-center p-3 rounded-lg text-slate-600 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                            <i class="fas fa-tasks mr-3"></i>
                            Work Logs
                        </a>
                    </li>
                    <li>
                        <a href="#paid-cycles" class="flex items-center p-3 rounded-lg text-slate-600 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                            <i class="fas fa-file-invoice-dollar mr-3"></i>
                            Paid Cycles
                        </a>
                    </li>
                    <li>
                        <a href="#reports" class="flex items-center p-3 rounded-lg text-slate-600 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                            <i class="fas fa-chart-bar mr-3"></i>
                            Reports
                        </a>
                    </li>
                    <li>
                        <a href="#settings" class="flex items-center p-3 rounded-lg text-slate-600 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                            <i class="fas fa-cog mr-3"></i>
                            Settings
                        </a>
                    </li>
                </ul>
                
                <div class="mt-8 p-4 bg-slate-100 dark:bg-jet-black rounded-lg">
                    <h3 class="text-sm font-semibold text-slate-700 dark:text-light-gray mb-2">Need help?</h3>
                    <p class="text-xs text-slate-500 dark:text-mid-gray mb-3">Check our documentation or contact support</p>
                    <button class="w-full py-2 px-3 bg-primary hover:bg-primary-hover text-white text-sm rounded-md transition-colors">
                        <i class="fas fa-question-circle mr-1"></i> Get Help
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="sticky top-0 z-20 bg-white/80 dark:bg-jet-black/80 backdrop-blur-lg border-b border-slate-200 dark:border-dark-border">
                <div class="flex items-center justify-between p-4">
                    <div class="flex items-center">
                        <button id="mobile-menu-btn" class="p-2 mr-2 text-slate-600 dark:text-light-gray md:hidden">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h2 class="text-xl font-semibold text-slate-900 dark:text-white" id="current-section-title">Dashboard</h2>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <div class="hidden md:block relative">
                            <input type="text" placeholder="Search..." class="pl-10 pr-4 py-2 w-64 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-mid-gray"></i>
                        </div>
                        
                        <button id="theme-toggle" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-dark-card">
                            <i id="theme-icon-light" class="fas fa-moon text-slate-600 dark:text-light-gray"></i>
                            <i id="theme-icon-dark" class="fas fa-sun text-light-gray hidden"></i>
                        </button>
                        
                        <div class="relative">
                            <button class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-dark-card">
                                <i class="fas fa-bell text-slate-600 dark:text-light-gray"></i>
                                <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                            </button>
                        </div>
                        
                        <div class="relative">
                            <button id="data-menu-btn" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-dark-card">
                                <i class="fas fa-database text-slate-600 dark:text-light-gray"></i>
                            </button>
                            
                            <div id="data-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-dark-card rounded-md shadow-lg py-1 ring-1 ring-black ring-opacity-5 z-50">
                                <button id="export-data-btn" class="w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                                    <i class="fas fa-file-export mr-2"></i> Export Data (JSON)
                                </button>
                                <label for="import-file" class="cursor-pointer w-full text-left block px-4 py-2 text-sm text-slate-700 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                                    <i class="fas fa-file-import mr-2"></i> Import Data (JSON)
                                </label>
                                <input type="file" id="import-file" class="hidden" accept=".json">
                                <button id="export-domains-btn" class="w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-light-gray hover:bg-slate-100 dark:hover:bg-jet-black">
                                    <i class="fas fa-globe mr-2"></i> Export Domains (CSV)
                                </button>
                                <div class="border-t border-slate-200 dark:border-dark-border my-1"></div>
                                <button id="clear-data-btn" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-slate-100 dark:hover:bg-jet-black">
                                    <i class="fas fa-trash-alt mr-2"></i> Clear All Data
                                </button>
                            </div>
                        </div>
                        
                        <div class="relative">
                            <button class="flex items-center space-x-2 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-dark-card">
                                <div class="h-8 w-8 rounded-full bg-gradient-to-r from-primary to-purple-600 flex items-center justify-center text-white font-semibold text-sm">SB</div>
                                <span class="text-sm font-medium text-slate-700 dark:text-light-gray hidden md:block">Sixty4Bit</span>
                                <i class="fas fa-chevron-down text-xs text-mid-gray hidden md:block"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto custom-scrollbar p-6">
                <!-- Dashboard Section -->
                <section id="dashboard" class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6 sr-only">Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm hover-card p-6 stat-card border-l-primary">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-slate-500 dark:text-mid-gray">Total Clients</p>
                                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="total-clients">0</h3>
                                </div>
                                <div class="h-12 w-12 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                                    <i class="fas fa-users text-blue-600 dark:text-blue-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm hover-card p-6 stat-card border-l-secondary">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-slate-500 dark:text-mid-gray">Unpaid Tasks</p>
                                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="unpaid-tasks">0</h3>
                                </div>
                                <div class="h-12 w-12 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
                                    <i class="fas fa-clock text-amber-600 dark:text-amber-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm hover-card p-6 stat-card border-l-green-500">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-slate-500 dark:text-mid-gray">Revenue This Month</p>
                                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="month-revenue">₹0.00</h3>
                                </div>
                                <div class="h-12 w-12 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                                    <i class="fas fa-rupee-sign text-green-600 dark:text-green-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm hover-card p-6 stat-card border-l-purple-500">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-slate-500 dark:text-mid-gray">Completed Cycles</p>
                                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="completed-projects">0</h3>
                                </div>
                                <div class="h-12 w-12 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                    <i class="fas fa-check-circle text-purple-600 dark:text-purple-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Recent Activity</h3>
                                <a href="#work-logs" class="text-sm text-primary hover:text-primary-hover font-medium nav-link">View All</a>
                            </div>
                            <div class="space-y-4" id="recent-activity">
                                <div class="flex items-center justify-center py-10 text-mid-gray">
                                    <i class="fas fa-tasks text-3xl mr-3"></i>
                                    <p>No recent activity</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Client Distribution</h3>
                                <a href="#clients" class="text-sm text-primary hover:text-primary-hover font-medium nav-link">View All</a>
                            </div>
                            <div class="flex items-center justify-center h-64" id="client-chart">
                                <p class="text-mid-gray">No client data available</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Clients Section -->
                <section id="clients" class="mb-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Clients</h2>
                        <button id="add-client-btn" class="bg-primary hover:bg-primary-hover text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add Client
                        </button>
                    </div>
                    
                    <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm overflow-hidden mb-6">
                        <div class="p-4 flex flex-col sm:flex-row sm:items-center justify-between space-y-3 sm:space-y-0">
                            <div class="relative w-full sm:w-64">
                                <input type="search" id="client-search" placeholder="Search clients..." class="pl-10 pr-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card w-full focus:outline-none focus:ring-2 focus:ring-primary">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-mid-gray"></i>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-slate-500 dark:text-mid-gray">
                                <thead class="text-xs uppercase bg-slate-100 dark:bg-jet-black text-slate-700 dark:text-light-gray">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Client</th>
                                        <th scope="col" class="px-6 py-3">Type</th>
                                        <th scope="col" class="px-6 py-3">Domain</th>
                                        <th scope="col" class="px-6 py-3">Unpaid Tasks</th>
                                        <th scope="col" class="px-6 py-3">Last Activity</th>
                                        <th scope="col" class="px-6 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="client-table-body">
                                    <tr>
                                        <td colspan="6" class="px-6 py-4 text-center text-mid-gray">
                                            No clients found. <button id="add-client-empty-btn" class="text-primary hover:underline">Add your first client</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <!-- Work Logs Section -->
                <section id="work-logs" class="mb-8 hidden">
                    <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Work Logs</h2>
                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                            <div class="relative">
                                <input type="search" id="log-search" placeholder="Search logs..." class="pl-10 pr-4 py-2 border rounded-lg bg-white dark:bg-dark-card border-slate-300 dark:border-dark-border w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-primary">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-mid-gray"></i>
                            </div>
                            <select id="log-filter-client" class="py-2 px-4 border rounded-lg bg-white dark:bg-dark-card border-slate-300 dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="all">All Clients</option>
                            </select>
                            <select id="log-filter-status" class="py-2 px-4 border rounded-lg bg-white dark:bg-dark-card border-slate-300 dark:border-dark-border focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="all">All Statuses</option>
                                <option value="unpaid">Unpaid</option>
                                <option value="paid">Paid</option>
                            </select>
                            <button id="add-log-btn" class="bg-secondary hover:bg-secondary-hover text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all flex items-center justify-center">
                                <i class="fas fa-plus mr-2"></i> Add Log
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-slate-500 dark:text-mid-gray">
                                <thead class="text-xs uppercase bg-slate-100 dark:bg-jet-black text-slate-700 dark:text-light-gray">
                                    <tr>
                                        <th scope="col" class="p-4">
                                            <div class="flex items-center">
                                                <input type="checkbox" id="select-all-logs" class="w-4 h-4 text-primary bg-slate-100 border-slate-300 rounded focus:ring-primary dark:focus:ring-offset-dark-card focus:ring-2 dark:bg-jet-black dark:border-dark-border">
                                                <label for="select-all-logs" class="sr-only">Select all</label>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-3">Client</th>
                                        <th scope="col" class="px-6 py-3">Task Type</th>
                                        <th scope="col" class="px-6 py-3">Details</th>
                                        <th scope="col" class="px-6 py-3">Date</th>
                                        <th scope="col" class="px-6 py-3">Amount</th>
                                        <th scope="col" class="px-6 py-3">Status</th>
                                        <th scope="col" class="px-6 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="log-table-body">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 text-center text-mid-gray">
                                            No work logs found. <button id="add-log-empty-btn" class="text-primary hover:underline">Add your first log</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="log-actions-bar" class="p-4 border-t border-dark-border flex justify-between items-center hidden">
                            <p id="selected-logs-count" class="text-sm font-medium text-light-gray"></p>
                            <div class="flex space-x-2">
                                <button id="create-cycle-btn" class="bg-primary hover:bg-primary-hover text-white font-bold py-2 px-4 rounded-md shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    Create Paid Cycle
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Paid Cycles Section -->
                <section id="paid-cycles" class="mb-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Paid Cycles</h2>
                        <!-- Future filter options can go here -->
                    </div>
                    
                    <div id="cycle-list" class="space-y-4">
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6 text-center text-mid-gray">
                            <i class="fas fa-file-invoice-dollar text-4xl mb-3"></i>
                            <p>No paid cycles created yet.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Reports Section -->
                <section id="reports" class="mb-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Reports & Analytics</h2>
                        <button id="export-report-btn" class="bg-primary hover:bg-primary-hover text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all flex items-center">
                            <i class="fas fa-download mr-2"></i> Export Report
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6 lg:col-span-2">
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Revenue Overview (Last 12 Months)</h3>
                            <div id="revenue-chart-container" class="relative h-64 md:h-80">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Earnings by Type</h3>
                            <div id="earnings-chart-container" class="relative h-64 md:h-80">
                               <canvas id="earningsByTypeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Settings Section -->
                <section id="settings" class="mb-8 hidden">
                    <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Settings</h2>
                     <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Preferences</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-light-gray">Dark Mode</p>
                                    <p class="text-xs text-mid-gray">Switch between light and dark themes</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="dark-mode-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="client-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
        <div class="bg-white dark:bg-dark-card rounded-xl shadow-xl w-full max-w-md p-6 transform scale-95 transition-transform duration-300">
            <h3 id="client-modal-title" class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Add New Client</h3>
            <form id="client-form" novalidate>
                <input type="hidden" id="client-id">
                <div class="space-y-4">
                    <div>
                        <label for="client-name" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-1">Client Name</label>
                        <input type="text" id="client-name" required class="w-full px-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label for="client-type" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-1">Project Type</label>
                        <select id="client-type" required class="w-full px-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                            <option>Landing Page</option>
                            <option>Website</option>
                            <option>Maintenance</option>
                            <option>Consulting</option>
                        </select>
                    </div>
                    <div>
                        <label for="client-domain" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-1">Domain URL (Optional)</label>
                        <input type="url" id="client-domain" placeholder="https://example.com" class="w-full px-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-slate-200 dark:bg-dark-border text-slate-800 dark:text-light-gray rounded-lg hover:bg-opacity-50 transition-colors">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">Save Client</button>
                </div>
            </form>
        </div>
    </div>

    <div id="log-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
        <div class="bg-white dark:bg-dark-card rounded-xl shadow-xl w-full max-w-md p-6 transform scale-95 transition-transform duration-300">
            <h3 id="log-modal-title" class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Add New Log</h3>
            <form id="log-form" novalidate>
                <input type="hidden" id="log-id">
                <div class="space-y-4">
                    <div>
                        <label for="log-client" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-1">Client</label>
                        <select id="log-client" required class="w-full px-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary"></select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="log-task-type" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-1">Task Type</label>
                            <select id="log-task-type" required class="w-full px-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="Landing Page">Landing Page</option>
                                <option value="Website">Website</option>
                                <option value="Telegram Bot">Telegram Bot</option>
                                <option value="Custom Work">Custom Work</option>
                            </select>
                        </div>
                         <div>
                            <label for="log-date" class="block text-sm font-medium text-slate-700 dark:text-light-gray mb-1">Date</label>
                            <input type="date" id="log-date" required class="w-full px-4 py-2 border border-slate-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    <!-- Conditional Fields -->
                    <div id="lp-options" class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-light-gray">Made using Systeme.io?</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="log-lp-systemeio">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="lp-url-field">
                            <label for="log-lp-url" class="block text-sm font-medium text-light-gray mb-1">URL</label>
                            <input type="url" id="log-lp-url" placeholder="https://example.com" class="w-full px-4 py-2 border border-dark-border rounded-lg bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        <div id="lp-systemeio-url-field" class="hidden">
                            <label for="log-lp-systemeio-url" class="block text-sm font-medium text-light-gray mb-1">Systeme.io Domain</label>
                            <input type="url" id="log-lp-systemeio-url" placeholder="https://user.systeme.io/page" class="w-full px-4 py-2 border border-dark-border rounded-lg bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    <div id="website-options" class="hidden">
                         <label for="log-website-url" class="block text-sm font-medium text-light-gray mb-1">Website URL</label>
                         <input type="url" id="log-website-url" placeholder="https://my-website.com" class="w-full px-4 py-2 border border-dark-border rounded-lg bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div id="bot-options" class="hidden">
                        <label for="log-bot-link" class="block text-sm font-medium text-light-gray mb-1">Telegram Bot Link</label>
                        <input type="url" id="log-bot-link" placeholder="https://t.me/your_bot" class="w-full px-4 py-2 border border-dark-border rounded-lg bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div id="custom-options" class="hidden">
                        <label for="log-custom-details" class="block text-sm font-medium text-light-gray mb-1">Work Details</label>
                        <textarea id="log-custom-details" rows="3" class="w-full px-4 py-2 border border-dark-border rounded-lg bg-dark-card focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-slate-200 dark:bg-dark-border text-slate-800 dark:text-light-gray rounded-lg hover:bg-opacity-50 transition-colors">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">Save Log</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="pricing-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
        <div class="bg-white dark:bg-dark-card rounded-xl shadow-xl w-full max-w-2xl transform scale-95 transition-transform duration-300">
             <form id="pricing-form">
                <div class="p-6">
                    <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Set Prices for Cycle</h3>
                    <div class="max-h-96 overflow-y-auto custom-scrollbar pr-2">
                        <table class="w-full text-sm text-left">
                            <thead class="sticky top-0 bg-white dark:bg-dark-card">
                                <tr>
                                    <th class="py-2">Task</th>
                                    <th class="py-2">Details</th>
                                    <th class="py-2 w-32 text-right">Amount (₹)</th>
                                </tr>
                            </thead>
                            <tbody id="pricing-table-body">
                                <!-- Pricing rows will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 dark:bg-jet-black/50 rounded-b-lg flex justify-between items-center">
                    <div class="text-lg font-bold">
                        Total: <span id="pricing-total">₹0.00</span>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" class="cancel-modal-btn px-4 py-2 bg-slate-200 dark:bg-dark-border text-slate-800 dark:text-light-gray rounded-lg hover:bg-opacity-50 transition-colors">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">Confirm & Create Cycle</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <div id="invoice-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 overflow-y-auto">
        <div id="invoice-modal-content" class="bg-white dark:bg-dark-card rounded-lg shadow-xl w-full max-w-4xl transform scale-95 transition-transform duration-300 my-8">
            <div id="invoice-content" class="p-8 md:p-12">
                <!-- Invoice content will be dynamically generated here -->
            </div>
             <div id="invoice-actions" class="p-6 bg-slate-50 dark:bg-jet-black/50 flex justify-end space-x-3 rounded-b-lg">
                <button type="button" class="cancel-modal-btn px-4 py-2 bg-slate-200 dark:bg-dark-border text-slate-800 dark:text-light-gray rounded-lg hover:bg-opacity-50 transition-colors">Close</button>
                <button type="button" id="print-invoice-btn" class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-secondary-hover transition-colors flex items-center"><i class="fas fa-print mr-2"></i>Print</button>
                <button type="button" id="download-invoice-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors flex items-center"><i class="fas fa-file-pdf mr-2"></i>Download PDF</button>
            </div>
        </div>
    </div>
    </div>

    <div id="toast-container"></div>

    <!-- Mobile Menu (hidden by default) -->
    <div id="mobile-menu-overlay" class="hidden fixed inset-0 z-30 bg-black bg-opacity-50 md:hidden"></div>
    <div id="mobile-menu" class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-dark-card shadow-lg z-40 transform transition-transform -translate-x-full md:hidden">
        <div class="p-6 border-b border-slate-200 dark:border-dark-border flex justify-between items-center">
            <div>
                 <h1 class="text-xl font-bold text-slate-900 dark:text-white flex items-center">
                    <i class="fas fa-laptop-code mr-2 text-primary"></i>
                    Sixty4Bit
                </h1>
                <p class="text-sm text-slate-500 dark:text-mid-gray mt-1">Manager</p>
            </div>
            <button id="close-mobile-menu" class="p-2 text-mid-gray">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="p-4">
            <ul id="mobile-nav" class="space-y-2">
                <!-- Mobile nav links will be cloned here -->
            </ul>
        </nav>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // #region Password Protection
    const DASHBOARD_PASSWORD = 'sneha14'; // Your dashboard password
    
    const checkLoginStatus = () => {
        const isLoggedIn = sessionStorage.getItem('dashboard_logged_in');
        if (isLoggedIn === 'true') {
            showDashboard();
        } else {
            showLoginScreen();
        }
    };
    
    const showLoginScreen = () => {
        document.getElementById('login-screen').classList.remove('hidden');
        document.getElementById('app').classList.add('hidden');
    };
    
    const showDashboard = () => {
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        // Initialize dashboard after showing it
        initializeDashboard();
    };
    
    const handleLogin = (password) => {
        if (password === DASHBOARD_PASSWORD) {
            sessionStorage.setItem('dashboard_logged_in', 'true');
            showDashboard();
            document.getElementById('login-error').classList.add('hidden');
        } else {
            document.getElementById('login-error').classList.remove('hidden');
            document.getElementById('login-password').value = '';
            document.getElementById('login-password').focus();
        }
    };
    
    // Login form handler
    document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const password = document.getElementById('login-password').value;
        handleLogin(password);
    });
    
    // Check login status on page load
    checkLoginStatus();
    
    // #region State Management
    let clients = [];
    let logs = [];
    let cycles = [];
    let isLoading = false;

    // Database API functions
    const API_BASE = '/.netlify/functions/db';

    const apiCall = async (endpoint, method = 'GET', data = null) => {
        try {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            
            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }
            
            const response = await fetch(`${API_BASE}${endpoint}`, options);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return await response.json();
        } catch (error) {
            console.error('API call failed:', error);
            showToast(`Database error: ${error.message}`, 'error');
            throw error;
        }
    };

    const loadData = async () => {
        if (isLoading) return;
        isLoading = true;
        
        try {
            showToast('Loading data...', 'success');
            const data = await apiCall('/all');
            clients = data.clients || [];
            logs = data.logs || [];
            cycles = data.cycles || [];
            renderAll();
            showToast('Data loaded successfully!', 'success');
        } catch (error) {
            showToast('Failed to load data', 'error');
        } finally {
            isLoading = false;
        }
    };

    const saveData = () => {
        // This function is now handled by individual CRUD operations
        renderAll();
    };
    // #endregion State Management

    // #region UI Elements & Chart Instances
    const clientModal = document.getElementById('client-modal');
    const clientForm = document.getElementById('client-form');
    const logModal = document.getElementById('log-modal');
    const logForm = document.getElementById('log-form');
    const invoiceModal = document.getElementById('invoice-modal');
    const pricingModal = document.getElementById('pricing-modal');
    const pricingForm = document.getElementById('pricing-form');
    let revenueChartInstance = null;
    let earningsChartInstance = null;
    // #endregion UI Elements & Chart Instances

    // #region Render Functions
    const renderAll = () => {
        renderClients();
        renderLogs();
        renderCycles();
        updateDashboardStats();
        updateLogClientFilter();
        updateLogSelectionActions();
        if(document.getElementById('reports').classList.contains('hidden') === false) {
            renderReports();
        }
    };
    
    const renderClients = () => {
        const tbody = document.getElementById('client-table-body');
        const searchTerm = document.getElementById('client-search').value.toLowerCase();
        
        const filteredClients = clients.filter(c => c.name.toLowerCase().includes(searchTerm));

        if (filteredClients.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-4 text-center text-mid-gray">No clients found. <button id="add-client-empty-btn-2" class="text-primary hover:underline">Add your first client</button></td></tr>`;
            document.getElementById('add-client-empty-btn-2').addEventListener('click', () => showModal(clientModal));
            return;
        }

        tbody.innerHTML = filteredClients.map(client => {
            const clientLogs = logs.filter(log => log.clientId === client.id);
            const unpaidLogs = clientLogs.filter(log => !log.paid);
            const lastActivity = clientLogs.length > 0 ? new Date(Math.max(...clientLogs.map(l => new Date(l.date).getTime()))).toLocaleDateString() : 'N/A';

            return `
                <tr class="bg-white dark:bg-dark-card hover:bg-slate-50 dark:hover:bg-jet-black border-b dark:border-dark-border">
                    <td class="px-6 py-4 font-medium text-slate-900 dark:text-white">${client.name}</td>
                    <td class="px-6 py-4">${client.type}</td>
                    <td class="px-6 py-4">${client.domain ? `<a href="${client.domain}" target="_blank" class="text-primary hover:underline">${client.domain}</a>` : 'N/A'}</td>
                    <td class="px-6 py-4">${unpaidLogs.length}</td>
                    <td class="px-6 py-4">${lastActivity}</td>
                    <td class="px-6 py-4 text-right">
                        <button class="edit-client-btn p-2 text-mid-gray hover:text-primary" data-id="${client.id}"><i class="fas fa-pencil-alt"></i></button>
                        <button class="delete-client-btn p-2 text-mid-gray hover:text-red-500" data-id="${client.id}"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `;
        }).join('');
    };

    const renderLogs = () => {
        const tbody = document.getElementById('log-table-body');
        const searchTerm = document.getElementById('log-search').value.toLowerCase();
        const clientFilter = document.getElementById('log-filter-client').value;
        const statusFilter = document.getElementById('log-filter-status').value;

        let filteredLogs = [...logs];

        if (searchTerm) {
            filteredLogs = filteredLogs.filter(log => 
                log.details.toLowerCase().includes(searchTerm) || 
                log.taskType.toLowerCase().includes(searchTerm) ||
                (clients.find(c => c.id === log.clientId)?.name.toLowerCase().includes(searchTerm))
            );
        }
        if (clientFilter !== 'all') {
            filteredLogs = filteredLogs.filter(log => log.clientId === clientFilter);
        }
        if (statusFilter !== 'all') {
            filteredLogs = filteredLogs.filter(log => (statusFilter === 'paid' ? log.paid : !log.paid));
        }
        
        filteredLogs.sort((a,b) => new Date(b.date) - new Date(a.date));

        if (filteredLogs.length === 0) {
            tbody.innerHTML = `<tr><td colspan="8" class="px-6 py-4 text-center text-mid-gray">No logs found. <button id="add-log-empty-btn-2" class="text-primary hover:underline">Add your first log</button></td></tr>`;
            document.getElementById('add-log-empty-btn-2').addEventListener('click', () => showModal(logModal));
            return;
        }

        tbody.innerHTML = filteredLogs.map(log => {
            const client = clients.find(c => c.id === log.clientId);
            const statusBadge = log.paid
                ? `<span class="badge bg-green-900 text-green-300">Paid</span>`
                : `<span class="badge bg-yellow-900 text-yellow-300">Unpaid</span>`;
            
            return `
                <tr class="bg-white dark:bg-dark-card hover:bg-slate-50 dark:hover:bg-jet-black border-b dark:border-dark-border">
                    <td class="p-4"><input type="checkbox" class="log-checkbox w-4 h-4 text-primary bg-slate-100 border-slate-300 rounded focus:ring-primary dark:focus:ring-offset-dark-card focus:ring-2 dark:bg-jet-black dark:border-dark-border" data-id="${log.id}" ${log.paid ? 'disabled' : ''}></td>
                    <td class="px-6 py-4 font-medium text-slate-900 dark:text-white">${client ? client.name : 'N/A'}</td>
                    <td class="px-6 py-4">${log.taskType}</td>
                    <td class="px-6 py-4 max-w-xs truncate" title="${log.details}">${log.details}</td>
                    <td class="px-6 py-4">${new Date(log.date).toLocaleDateString()}</td>
                    <td class="px-6 py-4">₹${log.amount.toFixed(2)}</td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4 text-right">
                        ${!log.paid ? `<button class="edit-log-btn p-2 text-mid-gray hover:text-primary" data-id="${log.id}"><i class="fas fa-pencil-alt"></i></button>` : ''}
                        <button class="delete-log-btn p-2 text-mid-gray hover:text-red-500" data-id="${log.id}"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `;
        }).join('');
    };
    
    const renderCycles = () => {
        const container = document.getElementById('cycle-list');
        if (cycles.length === 0) {
            container.innerHTML = `<div class="bg-white dark:bg-dark-card rounded-xl shadow-sm p-6 text-center text-mid-gray"><i class="fas fa-file-invoice-dollar text-4xl mb-3"></i><p>No paid cycles created yet.</p></div>`;
            return;
        }

        container.innerHTML = cycles.sort((a,b) => new Date(b.date) - new Date(a.date)).map(cycle => {
            const client = clients.find(c => c.id === cycle.clientId);
            return `
                <div class="bg-white dark:bg-dark-card rounded-xl shadow-sm">
                    <div class="p-4 flex justify-between items-center cursor-pointer" data-cycle-id="${cycle.id}">
                        <div>
                            <p class="font-semibold text-slate-900 dark:text-white">${client ? client.name : 'N/A'} - Cycle #${cycle.id.slice(0, 8)}</p>
                            <p class="text-sm text-mid-gray">Paid on ${new Date(cycle.date).toLocaleDateString()}</p>
                        </div>
                        <div class="text-right">
                             <p class="font-bold text-lg text-green-600 dark:text-green-400">₹${cycle.total.toFixed(2)}</p>
                             <button class="view-invoice-btn text-sm text-primary hover:underline" data-id="${cycle.id}">View Invoice</button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    };
    
    const updateDashboardStats = () => {
        document.getElementById('total-clients').textContent = clients.length;
        document.getElementById('unpaid-tasks').textContent = logs.filter(log => !log.paid).length;
        document.getElementById('completed-projects').textContent = cycles.length;
        
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();
        const monthRevenue = cycles
            .filter(c => { const d = new Date(c.date); return d.getMonth() === thisMonth && d.getFullYear() === thisYear; })
            .reduce((sum, c) => sum + c.total, 0);
        document.getElementById('month-revenue').textContent = `₹${monthRevenue.toFixed(2)}`;
        
        updateRecentActivity();
    };

    const updateRecentActivity = () => {
        const container = document.getElementById('recent-activity');
        const recentLogs = [...logs].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5);

        if (recentLogs.length === 0) {
            container.innerHTML = `<div class="flex items-center justify-center py-10 text-mid-gray"><i class="fas fa-tasks text-3xl mr-3"></i><p>No recent activity</p></div>`;
            return;
        }
        
        container.innerHTML = recentLogs.map(log => {
            const client = clients.find(c => c.id === log.clientId);
            if (!client) return '';
            
            return `
                <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-jet-black">
                    <div class="h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-tasks text-primary"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-light-gray">${log.taskType} for ${client.name}</p>
                        <p class="text-xs text-mid-gray">${new Date(log.date).toLocaleDateString()}</p>
                    </div>
                    <span class="badge ${log.paid ? 'bg-green-900 text-green-300' : 'bg-yellow-900 text-yellow-300'}">
                        ${log.paid ? 'Paid' : 'Unpaid'}
                    </span>
                </div>
            `;
        }).join('');
    };
    
    const updateLogClientFilter = () => {
        const select = document.getElementById('log-filter-client');
        select.innerHTML = `<option value="all">All Clients</option>` + clients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    };
    
    const updateLogSelectionActions = () => {
        const selectedCheckboxes = document.querySelectorAll('.log-checkbox:checked');
        const bar = document.getElementById('log-actions-bar');
        const countEl = document.getElementById('selected-logs-count');
        const createBtn = document.getElementById('create-cycle-btn');

        if (selectedCheckboxes.length > 0) {
            bar.classList.remove('hidden');
            countEl.textContent = `${selectedCheckboxes.length} log(s) selected.`;
            
            const firstClientId = logs.find(l => l.id === selectedCheckboxes[0].dataset.id).clientId;
            const allSameClient = Array.from(selectedCheckboxes).every(cb => logs.find(l => l.id === cb.dataset.id).clientId === firstClientId);
            
            createBtn.disabled = !allSameClient;
            createBtn.title = allSameClient ? 'Create a paid cycle for these logs' : 'Please select logs for a single client.';
        } else {
            bar.classList.add('hidden');
        }
    };
    // #endregion Render Functions

    // #region Reports & Analytics
    const renderReports = () => {
        renderRevenueChart();
        renderEarningsByTypeChart();
    };

    const renderRevenueChart = () => {
        const ctx = document.getElementById('revenueChart').getContext('2d');
        if (revenueChartInstance) {
            revenueChartInstance.destroy();
        }

        const labels = [];
        const data = Array(12).fill(0);
        const now = new Date();
        
        for (let i = 11; i >= 0; i--) {
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            labels.push(date.toLocaleString('default', { month: 'short', year: '2-digit' }));
        }

        cycles.forEach(cycle => {
            const cycleDate = new Date(cycle.date);
            const monthDiff = (now.getFullYear() - cycleDate.getFullYear()) * 12 + (now.getMonth() - cycleDate.getMonth());
            if (monthDiff >= 0 && monthDiff < 12) {
                data[11 - monthDiff] += cycle.total;
            }
        });
        
        const isDark = document.documentElement.classList.contains('dark');
        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
        const textColor = isDark ? '#d1d5db' : '#475569';

        revenueChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Revenue',
                    data: data,
                    backgroundColor: 'rgba(99, 102, 241, 0.7)',
                    borderColor: 'rgba(99, 102, 241, 1)',
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: textColor,
                            callback: value => `₹${value}`
                        },
                        grid: { color: gridColor }
                    },
                    x: {
                        ticks: { color: textColor },
                        grid: { color: 'transparent' }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: context => `Revenue: ₹${context.raw.toFixed(2)}`
                        }
                    }
                }
            }
        });
    };

    const renderEarningsByTypeChart = () => {
        const ctxContainer = document.getElementById('earnings-chart-container');
        if (earningsChartInstance) {
            earningsChartInstance.destroy();
        }

        const earningsByType = logs.reduce((acc, log) => {
            if (log.paid) {
                acc[log.taskType] = (acc[log.taskType] || 0) + log.amount;
            }
            return acc;
        }, {});

        const labels = Object.keys(earningsByType);
        const data = Object.values(earningsByType);

        ctxContainer.innerHTML = '<canvas id="earningsByTypeChart"></canvas>';
        
        if (labels.length === 0) {
            ctxContainer.innerHTML += `<div class="absolute inset-0 flex items-center justify-center text-mid-gray"><p>No earnings data available</p></div>`;
            return;
        }
        
        const isDark = document.documentElement.classList.contains('dark');
        const textColor = isDark ? '#d1d5db' : '#475569';
        
        earningsChartInstance = new Chart(document.getElementById('earningsByTypeChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#6366f1', '#14b8a6', '#ef4444', '#f59e0b', '#8b5cf6',
                        '#3b82f6', '#ec4899', '#6b7280'
                    ],
                    hoverOffset: 4,
                    borderColor: isDark ? '#121212' : '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: textColor }
                    },
                    tooltip: {
                        callbacks: {
                            label: context => `${context.label}: ₹${context.raw.toFixed(2)}`
                        }
                    }
                }
            }
        });
    };
    
    document.getElementById('export-report-btn').addEventListener('click', () => {
        const paidLogs = logs.filter(log => log.paid);
        if (paidLogs.length === 0) {
            showToast("No paid logs to export.", "error");
            return;
        }

        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Date,Client,Task Type,Details,Amount\n";

        paidLogs.forEach(log => {
            const client = clients.find(c => c.id === log.clientId);
            const clientName = client ? client.name.replace(/"/g, '""') : "N/A";
            const details = log.details.replace(/"/g, '""').replace(/\n/g, ' ');
            const row = [log.date, `"${clientName}"`, `"${log.taskType}"`, `"${details}"`, log.amount].join(',');
            csvContent += row + "\r\n";
        });
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `freelancer-report-${new Date().toISOString().slice(0,10)}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast("Report exported successfully.", "success");
    });
    // #endregion Reports & Analytics

    // #region Modal Handling
    const showModal = (modal) => {
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.querySelector('div > div').classList.remove('scale-95');
        }, 10);
    };

    const hideModal = (modal) => {
        modal.classList.add('opacity-0');
        modal.querySelector('div > div').classList.add('scale-95');
        setTimeout(() => modal.classList.add('hidden'), 300);
    };

    document.querySelectorAll('.cancel-modal-btn').forEach(btn => btn.addEventListener('click', (e) => hideModal(e.target.closest('.fixed'))));
    // #endregion Modal Handling

    // #region Client CRUD
    document.getElementById('add-client-btn').addEventListener('click', () => {
        clientForm.reset();
        clientForm.querySelector('#client-id').value = '';
        document.getElementById('client-modal-title').textContent = 'Add New Client';
        showModal(clientModal);
    });
    document.getElementById('client-table-body').addEventListener('click', (e) => {
        if (e.target.closest('.edit-client-btn')) {
            const id = e.target.closest('.edit-client-btn').dataset.id;
            const client = clients.find(c => c.id === id);
            if (client) {
                document.getElementById('client-id').value = client.id;
                document.getElementById('client-name').value = client.name;
                document.getElementById('client-type').value = client.type;
                document.getElementById('client-domain').value = client.domain;
                document.getElementById('client-modal-title').textContent = 'Edit Client';
                showModal(clientModal);
            }
        }
        if (e.target.closest('.delete-client-btn')) {
            const id = e.target.closest('.delete-client-btn').dataset.id;
            if (confirm('Are you sure you want to delete this client and all their associated logs?')) {
                try {
                    await apiCall('/clients', 'DELETE', { id });
                    showToast('Client deleted successfully.', 'success');
                    await loadData(); // Reload data from database
                } catch (error) {
                    showToast('Failed to delete client', 'error');
                }
            }
        }
    });

    clientForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('client-id').value;
        const clientData = {
            name: document.getElementById('client-name').value.trim(),
            type: document.getElementById('client-type').value,
            domain: document.getElementById('client-domain').value.trim(),
        };

        if (!clientData.name) {
             showToast('Client name is required.', 'error');
             return;
        }

        try {
            if (id) {
                // Update existing client
                await apiCall('/clients', 'PUT', { id, ...clientData });
                showToast('Client updated successfully.', 'success');
            } else {
                // Create new client
                await apiCall('/clients', 'POST', clientData);
                showToast('Client added successfully.', 'success');
            }
            await loadData(); // Reload data from database
            hideModal(clientModal);
        } catch (error) {
            showToast('Failed to save client', 'error');
        }
    });
    // #endregion Client CRUD

    // #region Log CRUD
    const updateLogModalFields = () => {
        const taskType = document.getElementById('log-task-type').value;
        document.getElementById('lp-options').classList.toggle('hidden', taskType !== 'Landing Page');
        document.getElementById('website-options').classList.toggle('hidden', taskType !== 'Website');
        document.getElementById('bot-options').classList.toggle('hidden', taskType !== 'Telegram Bot');
        document.getElementById('custom-options').classList.toggle('hidden', taskType !== 'Custom Work');
    };

    const updateLpUrlFields = () => {
        const isSysteme = document.getElementById('log-lp-systemeio').checked;
        document.getElementById('lp-url-field').classList.toggle('hidden', isSysteme);
        document.getElementById('lp-systemeio-url-field').classList.toggle('hidden', !isSysteme);
    };

    document.getElementById('log-task-type').addEventListener('change', updateLogModalFields);
    document.getElementById('log-lp-systemeio').addEventListener('change', updateLpUrlFields);

    const setupLogModal = (logId = null) => {
        logForm.reset();
        document.getElementById('log-id').value = logId || '';
        document.getElementById('log-modal-title').textContent = logId ? 'Edit Log' : 'Add New Log';
        
        const clientSelect = document.getElementById('log-client');
        clientSelect.innerHTML = clients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        
        if (logId) {
            const log = logs.find(l => l.id === logId);
            if (log) {
                clientSelect.value = log.clientId;
                document.getElementById('log-task-type').value = log.taskType;
                document.getElementById('log-date').value = log.date;
                // Deconstruct details back into fields
                if (log.taskType === 'Landing Page') {
                    const isSysteme = log.details.startsWith('Systeme.io URL:');
                    document.getElementById('log-lp-systemeio').checked = isSysteme;
                    const url = log.details.substring(log.details.indexOf(':') + 2);
                    if (isSysteme) document.getElementById('log-lp-systemeio-url').value = url;
                    else document.getElementById('log-lp-url').value = url;
                } else if (log.taskType === 'Website') {
                    document.getElementById('log-website-url').value = log.details.substring(log.details.indexOf(':') + 2);
                } else if (log.taskType === 'Telegram Bot') {
                    document.getElementById('log-bot-link').value = log.details.substring(log.details.indexOf(':') + 2);
                } else { // Custom Work
                    document.getElementById('log-custom-details').value = log.details;
                }
            }
        } else {
             document.getElementById('log-date').valueAsDate = new Date();
        }
        
        updateLogModalFields();
        updateLpUrlFields();
        showModal(logModal);
    };

    document.getElementById('add-log-btn').addEventListener('click', () => {
        if (clients.length === 0) {
            showToast('Please add a client first.', 'error');
            return;
        }
        setupLogModal();
    });

    document.getElementById('log-table-body').addEventListener('click', (e) => {
        const editBtn = e.target.closest('.edit-log-btn');
        if (editBtn) {
            setupLogModal(editBtn.dataset.id);
        }
        
        const deleteBtn = e.target.closest('.delete-log-btn');
        if (deleteBtn) {
            if (confirm('Are you sure you want to delete this log?')) {
                try {
                    await apiCall('/logs', 'DELETE', { id: deleteBtn.dataset.id });
                    showToast('Log deleted successfully.', 'success');
                    await loadData(); // Reload data from database
                } catch (error) {
                    showToast('Failed to delete log', 'error');
                }
            }
        }
        
        if (e.target.classList.contains('log-checkbox')) {
            updateLogSelectionActions();
        }
    });

    logForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('log-id').value;
        const taskType = document.getElementById('log-task-type').value;
        let details = '';

        switch (taskType) {
            case 'Landing Page':
                const isSysteme = document.getElementById('log-lp-systemeio').checked;
                const url = isSysteme ? document.getElementById('log-lp-systemeio-url').value : document.getElementById('log-lp-url').value;
                details = isSysteme ? `Systeme.io URL: ${url}` : `URL: ${url}`;
                break;
            case 'Website':
                details = `Website URL: ${document.getElementById('log-website-url').value}`;
                break;
            case 'Telegram Bot':
                details = `Bot Link: ${document.getElementById('log-bot-link').value}`;
                break;
            case 'Custom Work':
                details = document.getElementById('log-custom-details').value;
                break;
        }

        const logData = {
            clientId: document.getElementById('log-client').value,
            taskType: taskType,
            details: details,
            date: document.getElementById('log-date').value,
        };

        if (!logData.clientId || !logData.date) {
            showToast('Please fill all required fields.', 'error');
            return;
        }

        try {
            if (id) {
                // Update existing log
                await apiCall('/logs', 'PUT', { id, ...logData });
                showToast('Log updated successfully.', 'success');
            } else {
                // Create new log
                await apiCall('/logs', 'POST', logData);
                showToast('Log added successfully.', 'success');
            }
            await loadData(); // Reload data from database
            hideModal(logModal);
        } catch (error) {
            showToast('Failed to save log', 'error');
        }
    });
    // #endregion Log CRUD

    // #region Paid Cycles & Invoices
    const updatePricingTotal = () => {
        const inputs = document.querySelectorAll('#pricing-table-body .price-input');
        const total = Array.from(inputs).reduce((sum, input) => sum + (parseFloat(input.value) || 0), 0);
        document.getElementById('pricing-total').textContent = `₹${total.toFixed(2)}`;
    };

    document.getElementById('create-cycle-btn').addEventListener('click', () => {
        const selectedIds = Array.from(document.querySelectorAll('.log-checkbox:checked')).map(cb => cb.dataset.id);
        const tbody = document.getElementById('pricing-table-body');
        tbody.innerHTML = '';

        selectedIds.forEach(id => {
            const log = logs.find(l => l.id === id);
            tbody.innerHTML += `
                <tr class="border-b border-dark-border">
                    <td class="py-2 pr-2">${log.taskType}</td>
                    <td class="py-2 pr-2 text-mid-gray truncate max-w-xs">${log.details}</td>
                    <td class="py-2 text-right">
                        <input type="number" min="0" step="0.01" class="price-input w-full px-2 py-1 border border-dark-border rounded-md bg-dark-card text-right" data-log-id="${log.id}" value="${log.amount > 0 ? log.amount : ''}" required>
                    </td>
                </tr>
            `;
        });
        
        tbody.querySelectorAll('.price-input').forEach(input => input.addEventListener('input', updatePricingTotal));
        updatePricingTotal();
        showModal(pricingModal);
    });

    pricingForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const priceInputs = document.querySelectorAll('#pricing-table-body .price-input');
        const logIdsToUpdate = Array.from(priceInputs).map(input => input.dataset.logId);
        let cycleTotal = 0;

        // Update log amounts first
        for (const input of priceInputs) {
            const logId = input.dataset.logId;
            const amount = parseFloat(input.value) || 0;
            try {
                await apiCall('/logs', 'PUT', { 
                    id: logId, 
                    amount: amount, 
                    paid: true,
                    clientId: logs.find(l => l.id === logId).clientId,
                    taskType: logs.find(l => l.id === logId).taskType,
                    details: logs.find(l => l.id === logId).details,
                    date: logs.find(l => l.id === logId).date
                });
                cycleTotal += amount;
            } catch (error) {
                showToast('Failed to update log amounts', 'error');
                return;
            }
        }
        
        const firstLog = logs.find(l => l.id === logIdsToUpdate[0]);
        try {
            // Create the cycle
            const cycleData = {
                clientId: firstLog.clientId,
                logIds: logIdsToUpdate,
                total: cycleTotal,
                date: new Date().toISOString().split('T')[0]
            };
            
            const newCycle = await apiCall('/cycles', 'POST', cycleData);
            
            hideModal(pricingModal);
            showToast('Paid cycle created successfully.', 'success');
            document.getElementById('select-all-logs').checked = false;
            
            // Reload data and render invoice
            await loadData();
            renderInvoice(newCycle.id);
        } catch (error) {
            showToast('Failed to create cycle', 'error');
        }
    });

    const renderInvoice = (cycleId) => {
        const cycle = cycles.find(c => c.id === cycleId);
        if (!cycle) return;
        
        const client = clients.find(c => c.id === cycle.clientId);
        const cycleLogs = logs.filter(l => cycle.logIds.includes(l.id));

        const invoiceHTML = `
            <div class="flex justify-between items-start mb-10">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Invoice</h1>
                    <p class="text-mid-gray">Invoice #${cycle.id.slice(0, 8)}</p>
                    <p class="text-mid-gray">Date: ${new Date(cycle.date).toLocaleDateString()}</p>
                </div>
                <div class="text-right">
                    <h2 class="text-xl font-bold text-slate-800 dark:text-light-gray">Sixty4BitFreelancing</h2>
                    <p class="text-sm text-mid-gray">Your Freelancer</p>
                </div>
            </div>
            <div class="mb-10">
                <h3 class="font-semibold text-light-gray mb-2">Bill To:</h3>
                <p class="font-bold text-light-gray">${client.name}</p>
                ${client.domain ? `<p class="text-sm text-mid-gray">${client.domain}</p>` : ''}
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="border-b-2 border-slate-200 dark:border-dark-border">
                        <tr>
                            <th class="px-4 py-3 font-semibold text-slate-700 dark:text-light-gray uppercase text-sm">Description</th>
                            <th class="px-4 py-3 font-semibold text-slate-700 dark:text-light-gray uppercase text-sm text-right">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${cycleLogs.map(log => `
                            <tr class="border-b border-slate-100 dark:border-dark-border">
                                <td class="px-4 py-3">
                                    <p class="font-medium text-slate-800 dark:text-light-gray">${log.taskType}</p>
                                    <p class="text-sm text-mid-gray">${log.details}</p>
                                </td>
                                <td class="px-4 py-3 text-right">₹${log.amount.toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td class="px-4 py-5 text-right font-bold text-lg text-slate-800 dark:text-light-gray">Total</td>
                            <td class="px-4 py-5 text-right font-bold text-lg text-slate-800 dark:text-light-gray">₹${cycle.total.toFixed(2)}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="mt-12 text-center text-sm text-mid-gray">
                <p>Thank you for your business!</p>
            </div>
        `;
        document.getElementById('invoice-content').innerHTML = invoiceHTML;
        document.getElementById('download-invoice-btn').dataset.cycleId = cycleId;
        showModal(invoiceModal);
    };
    
    document.getElementById('cycle-list').addEventListener('click', e => {
        const btn = e.target.closest('.view-invoice-btn');
        if (btn) {
            renderInvoice(btn.dataset.id);
        }
    });

    document.getElementById('print-invoice-btn').addEventListener('click', () => window.print());
    
    document.getElementById('download-invoice-btn').addEventListener('click', async (e) => {
        const { jsPDF } = window.jspdf;
        const content = document.getElementById('invoice-content');
        const modalContent = document.getElementById('invoice-modal-content');
        const cycleId = e.currentTarget.dataset.cycleId;

        modalContent.classList.add('pdf-render-mode');

        try {
            const canvas = await html2canvas(content, { 
                scale: 2,
                backgroundColor: '#000000'
            });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save(`invoice-${cycleId.slice(0,8)}.pdf`);
        } finally {
            modalContent.classList.remove('pdf-render-mode');
        }
    });
    // #endregion Paid Cycles & Invoices

    // #region Navigation & UI
    const sections = ['dashboard', 'clients', 'work-logs', 'paid-cycles', 'reports', 'settings'];
    const navLinks = document.querySelectorAll('#main-nav a, .nav-link');
    const mobileNavContainer = document.getElementById('mobile-nav');
    
    const showSection = (sectionId) => {
        sections.forEach(id => document.getElementById(id).classList.add('hidden'));
        document.getElementById(sectionId).classList.remove('hidden');
        
        const linkEl = document.querySelector(`#main-nav a[href="#${sectionId}"]`) || document.querySelector(`#mobile-nav a[href="#${sectionId}"]`);
        document.getElementById('current-section-title').textContent = linkEl.textContent.trim();

        document.querySelectorAll('#main-nav a, #mobile-nav a').forEach(link => {
            link.classList.remove('text-primary', 'bg-primary/10', 'font-medium');
            link.classList.add('text-slate-600', 'dark:text-light-gray', 'hover:bg-slate-100', 'dark:hover:bg-jet-black');
            if(link.getAttribute('href') === `#${sectionId}`) {
                link.classList.add('text-primary', 'bg-primary/10', 'font-medium');
                link.classList.remove('text-slate-600', 'dark:text-light-gray', 'hover:bg-slate-100', 'dark:hover:bg-jet-black');
            }
        });

        if (sectionId === 'reports') {
            renderReports();
        }

        window.location.hash = sectionId;
    };

    navLinks.forEach(link => link.addEventListener('click', e => {
        e.preventDefault();
        showSection(link.getAttribute('href').substring(1));
    }));

    document.getElementById('mobile-menu-btn').addEventListener('click', () => {
        document.getElementById('mobile-menu-overlay').classList.remove('hidden');
        document.getElementById('mobile-menu').classList.remove('-translate-x-full');
    });

    const closeMobileMenu = () => {
        document.getElementById('mobile-menu-overlay').classList.add('hidden');
        document.getElementById('mobile-menu').classList.add('-translate-x-full');
    };
    
    document.getElementById('close-mobile-menu').addEventListener('click', closeMobileMenu);
    document.getElementById('mobile-menu-overlay').addEventListener('click', closeMobileMenu);

    mobileNavContainer.addEventListener('click', (e) => {
        if (e.target.closest('a')) {
            closeMobileMenu();
        }
    });
    // #endregion Navigation & UI
    
    // #region Theme Management
    const themeToggle = document.getElementById('theme-toggle');
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const themeIconLight = document.getElementById('theme-icon-light');
    const themeIconDark = document.getElementById('theme-icon-dark');

    const applyTheme = (theme) => {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            darkModeToggle.checked = true;
            themeIconLight.classList.add('hidden');
            themeIconDark.classList.remove('hidden');
        } else {
            document.documentElement.classList.remove('dark');
            darkModeToggle.checked = false;
            themeIconLight.classList.remove('hidden');
            themeIconDark.classList.add('hidden');
        }
        if(document.getElementById('reports').classList.contains('hidden') === false) {
            renderReports();
        }
    };

    themeToggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        applyTheme(isDark ? 'dark' : 'light');
        localStorage.setItem('dashboard-theme', isDark ? 'dark' : 'light');
    });

    darkModeToggle.addEventListener('change', (e) => {
        applyTheme(e.target.checked ? 'dark' : 'light');
        localStorage.setItem('dashboard-theme', e.target.checked ? 'dark' : 'light');
    });
    // #endregion Theme Management

    // #region Data Import/Export
    document.getElementById('data-menu-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        document.getElementById('data-menu').classList.toggle('hidden');
    });
    
    document.addEventListener('click', () => document.getElementById('data-menu').classList.add('hidden'));

    document.getElementById('export-data-btn').addEventListener('click', async () => {
        try {
            const data = await apiCall('/all');
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `freelancer-dash-backup-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Data exported successfully!', 'success');
        } catch (error) {
            showToast('Failed to export data', 'error');
        }
    });

    document.getElementById('import-file').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && confirm('This will overwrite all current data. Are you sure?')) {
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    if (data.clients && data.logs && data.cycles) {
                        localStorage.setItem(DB_KEY, event.target.result);
                        initializeApp();
                        showToast('Data imported successfully.', 'success');
                    } else {
                        throw new Error('Invalid data structure');
                    }
                } catch (err) {
                    showToast('Failed to import data. Invalid file.', 'error');
                }
            };
            reader.readAsText(file);
        }
        e.target.value = '';
    });
    
    document.getElementById('export-domains-btn').addEventListener('click', () => {
        let csvContent = "data:text/csv;charset=utf-8,Client Name,Domain URL\n";
        clients.forEach(c => {
            csvContent += `"${c.name}","${c.domain || ''}"\n`;
        });
        const encodedUri = encodeURI(csvContent);
        const a = document.createElement('a');
        a.href = encodedUri;
        a.download = "client-domains.csv";
        a.click();
    });

    document.getElementById('clear-data-btn').addEventListener('click', async () => {
        if (confirm('DANGER! This will delete all your data permanently from the database. Are you absolutely sure?')) {
            try {
                // This would require additional API endpoints for bulk deletion
                // For now, we'll show a message that this feature needs to be implemented
                showToast('Bulk delete feature coming soon. Please delete items individually.', 'error');
            } catch (error) {
                showToast('Failed to clear data', 'error');
            }
        }
    });
    // #endregion Data Import/Export

    // #region Event Listeners & Initialization
    const showToast = (message, type = 'success') => {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        document.getElementById('toast-container').appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    };

    ['client-search', 'log-search'].forEach(id => document.getElementById(id).addEventListener('input', renderAll));
    ['log-filter-client', 'log-filter-status'].forEach(id => document.getElementById(id).addEventListener('change', renderLogs));
    
    document.getElementById('select-all-logs').addEventListener('change', e => {
        document.querySelectorAll('.log-checkbox:not(:disabled)').forEach(cb => cb.checked = e.target.checked);
        updateLogSelectionActions();
    });

    const initializeDashboard = async () => {
        // Apply theme from localStorage (only theme setting remains in localStorage)
        const savedTheme = localStorage.getItem('dashboard-theme') || 'dark';
        applyTheme(savedTheme);
        
        mobileNavContainer.innerHTML = document.getElementById('main-nav').innerHTML;
        mobileNavContainer.querySelectorAll('a').forEach(link => link.addEventListener('click', e => {
            e.preventDefault();
            showSection(link.getAttribute('href').substring(1));
        }));
        
        const hash = window.location.hash.substring(1);
        if (hash && sections.includes(hash)) {
            showSection(hash);
        } else {
            showSection('dashboard');
        }
        
        // Load data from database
        await loadData();
    };
    
    const initializeApp = () => {
        // This is now handled by checkLoginStatus()
        // The dashboard will initialize after successful login
    };

    initializeApp();
    // #endregion Event Listeners & Initialization
});
</script>

</body>
</html>
